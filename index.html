<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Métricas Profundas — El Rancherito</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,sans-serif;background:linear-gradient(135deg,#fff7ed 0%,#fff 40%,#eff6ff 100%);min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:16px}
h1{font-size:28px;font-weight:800;background:linear-gradient(135deg,#f97316,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:#6b7280;font-size:13px;margin-top:4px}
.tabs{display:flex;gap:8px;margin:20px 0;flex-wrap:wrap}
.tab{padding:8px 18px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .2s}
.tab-active{background:#f97316;color:#fff;box-shadow:0 4px 14px rgba(249,115,22,.3)}
.tab-inactive{background:#fff;color:#6b7280;border:1px solid #e5e7eb}
.tab-inactive:hover{background:#fff7ed;color:#f97316}
.grid{display:grid;gap:16px}
.g2{grid-template-columns:1fr 1fr}
.g4{grid-template-columns:repeat(4,1fr)}
.g5{grid-template-columns:repeat(5,1fr)}
.card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 1px 3px rgba(0,0,0,.06);border:1px solid #f1f5f9}
.kpi-label{font-size:11px;color:#9ca3af;text-transform:uppercase;letter-spacing:.5px}
.kpi-value{font-size:22px;font-weight:800;margin-top:4px}
.kpi-sub{font-size:11px;color:#9ca3af;margin-top:2px}
.card-title{font-weight:700;color:#374151;margin-bottom:14px;font-size:14px}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:#1e293b;color:#fff;padding:8px 12px;text-align:left;font-weight:600;font-size:11px}
th:not(:first-child){text-align:right}
td{padding:7px 12px;border-bottom:1px solid #f1f5f9}
td:not(:first-child){text-align:right}
tr:nth-child(even){background:#f8fafc}
.bold{font-weight:700}
.badge{display:inline-block;padding:2px 8px;border-radius:6px;font-size:10px;font-weight:700}
.bg{background:#dcfce7;color:#15803d}.by{background:#fef9c3;color:#a16207}.br{background:#fee2e2;color:#dc2626}
.footer{text-align:center;color:#9ca3af;font-size:11px;margin-top:30px;padding:16px}
.section{display:none}.section.active{display:block}
.space>*+*{margin-top:16px}
.overflow-x{overflow-x:auto}
.hl{font-weight:700;color:#f97316}
canvas{max-height:320px}
@media(max-width:768px){.g2,.g4,.g5{grid-template-columns:1fr}.g4{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<div class="container">
  <div>
    <h1>Métricas Profundas — El Rancherito</h1>
    <p class="subtitle">15 Nov 2025 – 15 Ene 2026 · 60 días · 7 sedes · 103,977 platos</p>
  </div>

  <div class="tabs" id="tabs"></div>

  <!-- RESUMEN -->
  <div class="section active" id="sec-resumen">
    <div class="space">
      <div class="grid g4" id="kpi-grid"></div>
      <div class="grid g2">
        <div class="card"><div class="card-title">Ingresos por Sede</div><canvas id="chart-ingresos"></canvas></div>
        <div class="card"><div class="card-title">Distribución Sopas (kg)</div><canvas id="chart-sopas-pie"></canvas></div>
      </div>
    </div>
  </div>

  <!-- SEDES -->
  <div class="section" id="sec-sedes">
    <div class="space">
      <div class="grid g2">
        <div class="card"><div class="card-title">Platos/Día por Sede</div><canvas id="chart-platos-dia"></canvas></div>
        <div class="card"><div class="card-title">Ticket Promedio por Sede</div><canvas id="chart-ticket"></canvas></div>
      </div>
      <div class="card overflow-x"><div class="card-title">Detalle Financiero por Sede</div><div id="table-financiero"></div></div>
    </div>
  </div>

  <!-- PRODUCTOS -->
  <div class="section" id="sec-productos">
    <div class="space">
      <div class="card"><div class="card-title">Top 10 Productos por Ingreso</div><canvas id="chart-top-prod"></canvas></div>
      <div class="card overflow-x"><div class="card-title">Análisis Pareto — Top 10</div><div id="table-pareto"></div></div>
    </div>
  </div>

  <!-- SOPAS -->
  <div class="section" id="sec-sopas">
    <div class="space">
      <div class="grid g5" id="kpi-sopas"></div>
      <div class="grid g2">
        <div class="card"><div class="card-title">Consumo por Sede (kg) — Stacked</div><canvas id="chart-sopas-stack"></canvas></div>
        <div class="card"><div class="card-title">Distribución % del Total</div><canvas id="chart-sopas-donut"></canvas></div>
      </div>
      <div class="card overflow-x"><div class="card-title">Detalle Consumo Sopa por Sede (kg)</div><div id="table-sopas"></div></div>
    </div>
  </div>

  <!-- EFICIENCIA -->
  <div class="section" id="sec-eficiencia">
    <div class="space">
      <div class="card"><div class="card-title">Ingreso por kg de Sopa ($/kg) — Mayor = Más Eficiente</div><canvas id="chart-efic"></canvas></div>
      <div class="grid g2">
        <div class="card"><div class="card-title">Índice HHI (Concentración)<br><span style="font-size:11px;color:#9ca3af;font-weight:400">Menor HHI = mayor diversidad</span></div><canvas id="chart-hhi"></canvas></div>
        <div class="card overflow-x"><div class="card-title">Ranking de Eficiencia</div><div id="table-efic"></div></div>
      </div>
    </div>
  </div>

  <!-- CATEGORÍAS -->
  <div class="section" id="sec-categorias">
    <div class="space">
      <div class="grid g2">
        <div class="card"><div class="card-title">Platos por Categoría</div><canvas id="chart-cat-bar"></canvas></div>
        <div class="card"><div class="card-title">Ingreso por Categoría</div><canvas id="chart-cat-pie"></canvas></div>
      </div>
      <div class="card overflow-x"><div class="card-title">Mix de Categorías por Sede (%)</div><div id="table-mix"></div></div>
    </div>
  </div>

  <div class="footer">El Rancherito · Análisis Profundo de Métricas · 15 Nov 2025 – 15 Ene 2026 · 7 Sedes</div>
</div>

<script>
const COLORS=['#f97316','#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899'];
const fmt=n=>n!=null?n.toLocaleString('es-CO'):'-';

const sedes=[
  {s:'Rionegro',p:20354,sub:759346885,tk:37307,d:339,fr:4906,le:473,aj:832,sa:1412,mo:1126,ef:108374,hhi:647,pr:44},
  {s:'Palmas',p:18046,sub:705802060,tk:39111,d:301,fr:4217,le:408,aj:650,sa:1732,mo:818,ef:103363,hhi:617,pr:44},
  {s:'Envigado',p:17170,sub:646230693,tk:37637,d:286,fr:3619,le:480,aj:782,sa:1246,mo:1128,ef:89723,hhi:527,pr:46},
  {s:'Copacabana',p:15516,sub:581449438,tk:37474,d:259,fr:3471,le:414,aj:527,sa:815,mo:953,ef:101006,hhi:602,pr:50},
  {s:'Guarne',p:13833,sub:516633627,tk:37348,d:231,fr:3564,le:395,aj:571,sa:797,mo:867,ef:85078,hhi:499,pr:46},
  {s:'Molinos',p:12589,sub:473059231,tk:37577,d:210,fr:2536,le:344,aj:606,sa:946,mo:856,ef:87626,hhi:532,pr:46},
  {s:'Caldas',p:6469,sub:233838497,tk:36148,d:108,fr:1538,le:190,aj:214,sa:314,mo:393,ef:98031,hhi:562,pr:44},
];

const prods=[
  {n:'Bandeja Paisa Rancherito',q:12787,r:643082902},
  {n:'Cazuela Tradicional',q:10959,r:406826899},
  {n:'Frijoles c/Chicharrón',q:7977,r:250397421},
  {n:'Sancocho Mediano',q:6752,r:221177689},
  {n:'Mondongo Mediano',q:6190,r:196738869},
  {n:'Cazuela Ranchera',q:5085,r:183132074},
  {n:'Calentao c/Chicharrón',q:4613,r:169720700},
  {n:'Bandeja Paisa Mediana',q:4576,r:214906901},
  {n:'Ajiaco Mediano',q:4384,r:135335709},
  {n:'Cazuela de Lentejas',q:4329,r:149654290},
];

const sopas=[
  {n:'Fríjol',v:23851,pct:'54.0%',d:397.5},
  {n:'Sancocho',v:7262,pct:'16.5%',d:121.0},
  {n:'Mondongo',v:6139,pct:'13.9%',d:102.3},
  {n:'Ajiaco',v:4182,pct:'9.5%',d:69.7},
  {n:'Lentejas',v:2706,pct:'6.1%',d:45.1},
];

const cats=[
  {c:'Típicos',p:40486,r:1636382302,t:40418,pr:25},
  {c:'Sopas',p:26676,r:773473164,t:28993,pr:16},
  {c:'Cazuelas',p:25004,r:901407656,t:36051,pr:7},
  {c:'Cocina Trad.',p:26207,r:936765776,t:35745,pr:6},
  {c:'Desayuno Cac.',p:1151,r:34077524,t:29607,pr:2},
];

const mix=[
  {s:'Rionegro',T:28.4,Ca:18.8,Co:18.5,So:33.2},
  {s:'Guarne',T:35.3,Ca:24.3,Co:23.2,So:16.1},
  {s:'Copacabana',T:34.8,Ca:20.0,Co:19.3,So:25.1},
  {s:'Palmas',T:36.3,Ca:17.6,Co:20.9,So:24.3},
  {s:'Caldas',T:35.5,Ca:23.1,Co:19.6,So:19.4},
  {s:'Envigado',T:34.2,Ca:24.3,Co:26.3,So:14.8},
  {s:'Molinos',T:37.0,Ca:22.5,Co:28.6,So:11.5},
];

// TABS
const tabNames=['Resumen','Sedes','Productos','Sopas','Eficiencia','Categorías'];
const tabIds=['resumen','sedes','productos','sopas','eficiencia','categorias'];
let activeTab=0;

function switchTab(i){
  activeTab=i;
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec-'+tabIds[i]).classList.add('active');
  document.querySelectorAll('.tab').forEach((t,j)=>{t.className='tab '+(j===i?'tab-active':'tab-inactive')});
}

const tabsEl=document.getElementById('tabs');
tabNames.forEach((n,i)=>{
  const b=document.createElement('button');
  b.textContent=n;b.className='tab '+(i===0?'tab-active':'tab-inactive');
  b.onclick=()=>switchTab(i);tabsEl.appendChild(b);
});

// KPI CARDS
function kpi(label,value,sub,color='#f97316'){
  return `<div class="card"><div class="kpi-label">${label}</div><div class="kpi-value" style="color:${color}">${value}</div>${sub?`<div class="kpi-sub">${sub}</div>`:''}</div>`;
}
document.getElementById('kpi-grid').innerHTML=[
  kpi('Platos Totales','103,977','1,733/día'),
  kpi('Ingreso Total','$3,916M','$65.3M/día','#3b82f6'),
  kpi('Ticket Promedio','$37,666','por plato','#10b981'),
  kpi('Producción Sopas','735.7 kg/día','44,139 kg total','#ef4444'),
  kpi('Productos Activos','55','39 en todas las sedes','#8b5cf6'),
  kpi('Pareto 80/20','15 productos','= 80% del ingreso','#f59e0b'),
  kpi('Ollas/Día (160kg)','4.6','735.7 kg/día','#ec4899'),
  kpi('Mejor Eficiencia','Rionegro','$108,374/kg sopa','#14b8a6'),
].join('');

document.getElementById('kpi-sopas').innerHTML=sopas.map((s,i)=>kpi(s.n,`${s.d} kg/día`,`${fmt(s.v)} kg · ${s.pct}`,COLORS[i])).join('');

// HELPER: make table
function makeTable(headers,rows,id){
  let h='<table><thead><tr>'+headers.map(h=>`<th>${h}</th>`).join('')+'</tr></thead><tbody>';
  rows.forEach(r=>{h+='<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>'});
  h+='</tbody></table>';
  document.getElementById(id).innerHTML=h;
}

// TABLE: Financiero
makeTable(['Sede','Platos','Subtotal','Ticket','Platos/Día','Productos','% Platos'],
  sedes.map(s=>[`<b>${s.s}</b>`,fmt(s.p),'$'+fmt(s.sub),'$'+fmt(s.tk),s.d,s.pr,(s.p/103977*100).toFixed(1)+'%']),
  'table-financiero');

// TABLE: Pareto
let acum=0;
makeTable(['#','Producto','Cantidad','Ingreso','% Ingreso','Acum %','Zona'],
  prods.map((p,i)=>{const pct=p.r/4282106422*100;acum+=pct;const z=acum<=80?'A':acum<=95?'B':'C';const cls=z==='A'?'bg':z==='B'?'by':'br';
    return[i+1,`<b>${p.n}</b>`,fmt(p.q),'$'+fmt(p.r),pct.toFixed(1)+'%',`<b>${acum.toFixed(1)}%</b>`,`<span class="badge ${cls}">${z}</span>`]}),
  'table-pareto');

// TABLE: Sopas
makeTable(['Sede','Fríjol','Lentejas','Ajiaco','Sancocho','Mondongo','TOTAL','kg/Día','Ollas/Día'],
  sedes.map(s=>{const t=s.fr+s.le+s.aj+s.sa+s.mo;return[`<b>${s.s}</b>`,fmt(s.fr),fmt(s.le),fmt(s.aj),fmt(s.sa),fmt(s.mo),`<b>${fmt(t)}</b>`,(t/60).toFixed(1),(t/60/160).toFixed(1)]}),
  'table-sopas');

// TABLE: Eficiencia
const efSorted=[...sedes].sort((a,b)=>b.ef-a.ef);
makeTable(['#','Sede','$/kg Sopa','HHI','Productos'],
  efSorted.map((s,i)=>{const cls=s.ef>100000?'bg':s.ef>90000?'by':'br';
    return[i+1,`<b>${s.s}</b>`,`<span class="badge ${cls}">$${fmt(s.ef)}</span>`,s.hhi,s.pr]}),
  'table-efic');

// TABLE: Mix
makeTable(['Sede','Típicos','Cazuelas','Cocina Trad.','Sopas'],
  mix.map(m=>{const vals=[m.T,m.Ca,m.Co,m.So];const mx=Math.max(...vals);
    return[`<b>${m.s}</b>`,...vals.map(v=>v===mx?`<span class="hl">${v.toFixed(1)}%</span>`:v.toFixed(1)+'%')]}),
  'table-mix');

// CHARTS
Chart.defaults.font.family='Inter';
Chart.defaults.font.size=11;

// Ingresos por Sede (horizontal bar)
new Chart(document.getElementById('chart-ingresos'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[{data:sedes.map(s=>s.sub),backgroundColor:'#f97316',borderRadius:6}]},
  options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+fmt(c.raw)}}},scales:{x:{ticks:{callback:v=>'$'+(v/1e6).toFixed(0)+'M'}}}}
});

// Sopas Pie
new Chart(document.getElementById('chart-sopas-pie'),{
  type:'doughnut',
  data:{labels:sopas.map(s=>s.n+' '+s.pct),datasets:[{data:sopas.map(s=>s.v),backgroundColor:COLORS.slice(0,5),borderWidth:2,borderColor:'#fff'}]},
  options:{plugins:{legend:{position:'bottom'}}}
});

// Platos/Día
new Chart(document.getElementById('chart-platos-dia'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[{data:sedes.map(s=>s.d),backgroundColor:'#3b82f6',borderRadius:6}]},
  options:{plugins:{legend:{display:false}}}
});

// Ticket
new Chart(document.getElementById('chart-ticket'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[{data:sedes.map(s=>s.tk),backgroundColor:'#10b981',borderRadius:6}]},
  options:{plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+fmt(c.raw)}}},scales:{y:{min:34000,max:40000}}}
});

// Top Productos
new Chart(document.getElementById('chart-top-prod'),{
  type:'bar',
  data:{labels:prods.map(p=>p.n),datasets:[{data:prods.map(p=>p.r),backgroundColor:'#f97316',borderRadius:6}]},
  options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+fmt(c.raw)}}},scales:{x:{ticks:{callback:v=>'$'+(v/1e6).toFixed(0)+'M'}}}}
});

// Sopas Stacked
new Chart(document.getElementById('chart-sopas-stack'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[
    {label:'Fríjol',data:sedes.map(s=>s.fr),backgroundColor:'#f97316'},
    {label:'Sancocho',data:sedes.map(s=>s.sa),backgroundColor:'#10b981'},
    {label:'Mondongo',data:sedes.map(s=>s.mo),backgroundColor:'#3b82f6'},
    {label:'Ajiaco',data:sedes.map(s=>s.aj),backgroundColor:'#f59e0b'},
    {label:'Lentejas',data:sedes.map(s=>s.le),backgroundColor:'#8b5cf6'},
  ]},
  options:{plugins:{legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true}}}
});

// Sopas Donut
new Chart(document.getElementById('chart-sopas-donut'),{
  type:'doughnut',
  data:{labels:sopas.map(s=>s.n+' '+s.pct),datasets:[{data:sopas.map(s=>s.v),backgroundColor:COLORS.slice(0,5),borderWidth:3,borderColor:'#fff'}]},
  options:{plugins:{legend:{position:'bottom'}},cutout:'50%'}
});

// Eficiencia
new Chart(document.getElementById('chart-efic'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[{data:sedes.map(s=>s.ef),backgroundColor:sedes.map(s=>s.ef>100000?'#10b981':s.ef>90000?'#f59e0b':'#ef4444'),borderRadius:6}]},
  options:{plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+fmt(c.raw)+'/kg'}}},scales:{y:{min:80000,max:115000}}}
});

// HHI
new Chart(document.getElementById('chart-hhi'),{
  type:'bar',
  data:{labels:sedes.map(s=>s.s),datasets:[{data:sedes.map(s=>s.hhi),backgroundColor:'#8b5cf6',borderRadius:6}]},
  options:{plugins:{legend:{display:false}},scales:{y:{min:400,max:700}}}
});

// Categorías Bar
new Chart(document.getElementById('chart-cat-bar'),{
  type:'bar',
  data:{labels:cats.map(c=>c.c),datasets:[{data:cats.map(c=>c.p),backgroundColor:COLORS.slice(0,5),borderRadius:6}]},
  options:{plugins:{legend:{display:false}}}
});

// Categorías Pie
new Chart(document.getElementById('chart-cat-pie'),{
  type:'doughnut',
  data:{labels:cats.map(c=>c.c),datasets:[{data:cats.map(c=>c.r),backgroundColor:COLORS.slice(0,5),borderWidth:2,borderColor:'#fff'}]},
  options:{plugins:{legend:{position:'bottom'}}}
});
</script>
</body>
</html>
